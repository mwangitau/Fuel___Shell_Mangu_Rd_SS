<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kiryan Energy Ltd â€” Mangu Shell SS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --night:    #080c14;
      --deep:     #0d1525;
      --steel:    #121e30;
      --panel:    rgba(255,255,255,0.04);
      --rim:      rgba(255,255,255,0.08);
      --glow:     #f59e0b;
      --glow2:    #ea580c;
      --dx:       #94a3b8;
      --ux:       #34d399;
      --vp:       #f87171;
      --lpg:      #fb923c;
      --text:     #e2e8f0;
      --muted:    #64748b;
      --success:  #10b981;
      --danger:   #ef4444;
    }

    /* â”€â”€â”€ LIGHT THEME â”€â”€â”€ */
    [data-theme="light"] {
      --night:  #f1f5f9;
      --deep:   #e2e8f0;
      --steel:  #cbd5e1;
      --panel:  rgba(255,255,255,0.90);
      --rim:    rgba(0,0,0,0.08);
      --glow:   #d97706;
      --glow2:  #ea580c;
      --dx:     #475569;
      --ux:     #059669;
      --vp:     #dc2626;
      --lpg:    #ea580c;
      --text:   #0f172a;
      --muted:  #64748b;
      --success:#059669;
      --danger: #dc2626;
    }

    /* light: flip grid lines to dark-on-light */
    [data-theme="light"] body::before {
      background-image:
        linear-gradient(rgba(15,31,61,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(15,31,61,0.04) 1px, transparent 1px);
    }

    /* light: orb colours shift to warmer, softer tones */
    [data-theme="light"] .orb-1 {
      background: radial-gradient(circle, rgba(245,158,11,0.18) 0%, transparent 70%);
    }
    [data-theme="light"] .orb-2 {
      background: radial-gradient(circle, rgba(234,88,12,0.12) 0%, transparent 70%);
    }
    [data-theme="light"] .orb-3 {
      background: radial-gradient(circle, rgba(5,150,105,0.09) 0%, transparent 70%);
    }

    /* light: cards need a visible shadow to lift off the background */
    [data-theme="light"] .ticker-card,
    [data-theme="light"] .dash-card {
      box-shadow: 0 2px 16px rgba(0,0,0,0.08);
    }
    [data-theme="light"] .ticker-card:hover {
      border-color: rgba(0,0,0,0.18);
      box-shadow: 0 20px 48px rgba(0,0,0,0.14);
    }
    [data-theme="light"] .dash-card:hover {
      box-shadow: 0 32px 64px rgba(0,0,0,0.18);
      border-color: rgba(0,0,0,0.18);
    }

    /* light: ticker value white â†’ near-black */
    [data-theme="light"] .ticker-value { color: #0f172a; }

    /* light: card titles white â†’ near-black */
    [data-theme="light"] .card-title { color: #0f172a; }

    /* light: brand gradient stays amber/orange but anchors to dark */
    [data-theme="light"] .brand-name {
      background: linear-gradient(135deg, #1e3c72 0%, var(--glow) 60%, var(--glow2) 100%);
      -webkit-background-clip: text;
      background-clip: text;
    }

    /* light: skeleton shimmer */
    [data-theme="light"] .skeleton {
      background: linear-gradient(90deg, var(--steel) 25%, rgba(255,255,255,0.8) 50%, var(--steel) 75%);
      background-size: 200% 100%;
    }

    /* light: card arrow */
    [data-theme="light"] .card-arrow { background: rgba(0,0,0,0.07); color: #1e3c72; }
    [data-theme="light"] .dash-card:hover .card-arrow { background: rgba(217,119,6,0.15); }

    /* light: footer copy */
    [data-theme="light"] .footer-copy strong { color: #334155; }

    /* â”€â”€â”€ THEME TOGGLE BUTTON â”€â”€â”€ */
    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--panel);
      border: 1px solid var(--rim);
      border-radius: 100px;
      cursor: pointer;
      font-family: 'Space Mono', monospace;
      font-size: 0.72rem;
      color: var(--muted);
      transition: background 0.25s, border-color 0.25s, color 0.25s, box-shadow 0.25s;
      outline: none;
      user-select: none;
    }
    .theme-toggle:hover {
      border-color: var(--glow);
      color: var(--glow);
      box-shadow: 0 0 12px rgba(245,158,11,0.15);
    }
    .theme-toggle .toggle-track {
      width: 32px; height: 18px;
      background: var(--rim);
      border-radius: 9px;
      position: relative;
      transition: background 0.3s ease;
      flex-shrink: 0;
    }
    .theme-toggle .toggle-thumb {
      position: absolute;
      top: 3px; left: 3px;
      width: 12px; height: 12px;
      border-radius: 50%;
      background: var(--muted);
      transition: transform 0.3s ease, background 0.3s ease;
    }
    [data-theme="light"] .theme-toggle .toggle-track { background: rgba(217,119,6,0.25); }
    [data-theme="light"] .theme-toggle .toggle-thumb { transform: translateX(14px); background: var(--glow); }

    /* header right cluster */
    .header-right-cluster {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--night);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.4s ease, color 0.35s ease;
    }

    /* â”€â”€â”€ BACKGROUND GRID â”€â”€â”€ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(245,158,11,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(245,158,11,0.03) 1px, transparent 1px);
      background-size: 60px 60px;
      pointer-events: none;
      z-index: 0;
    }

    /* â”€â”€â”€ AMBIENT ORBS â”€â”€â”€ */
    .orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(100px);
      pointer-events: none;
      z-index: 0;
    }
    .orb-1 {
      width: 600px; height: 600px;
      background: radial-gradient(circle, rgba(245,158,11,0.12) 0%, transparent 70%);
      top: -200px; left: -200px;
      animation: drift1 18s ease-in-out infinite;
    }
    .orb-2 {
      width: 500px; height: 500px;
      background: radial-gradient(circle, rgba(234,88,12,0.10) 0%, transparent 70%);
      bottom: -100px; right: -100px;
      animation: drift2 22s ease-in-out infinite;
    }
    .orb-3 {
      width: 300px; height: 300px;
      background: radial-gradient(circle, rgba(52,211,153,0.06) 0%, transparent 70%);
      top: 50%; left: 50%;
      animation: drift3 14s ease-in-out infinite;
    }
    @keyframes drift1 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(60px,80px)} }
    @keyframes drift2 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(-80px,-60px)} }
    @keyframes drift3 { 0%,100%{transform:translate(-50%,-50%) scale(1)} 50%{transform:translate(-50%,-50%) scale(1.3)} }

    /* â”€â”€â”€ WRAPPER â”€â”€â”€ */
    .wrapper {
      position: relative;
      z-index: 1;
      max-width: 1280px;
      margin: 0 auto;
      padding: 40px 24px 60px;
    }

    /* â”€â”€â”€ HEADER â”€â”€â”€ */
    .site-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 64px;
      padding-bottom: 32px;
      border-bottom: 1px solid var(--rim);
      animation: fadeDown 0.7s ease both;
    }
    .brand-block {}
    .brand-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(2.2rem, 5vw, 3.8rem);
      letter-spacing: 3px;
      line-height: 1;
      background: linear-gradient(135deg, #fff 0%, var(--glow) 60%, var(--glow2) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .brand-sub {
      font-size: 0.8rem;
      color: var(--muted);
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-top: 4px;
    }
    .live-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--panel);
      border: 1px solid var(--rim);
      border-radius: 100px;
      font-family: 'Space Mono', monospace;
      font-size: 0.72rem;
      color: var(--muted);
    }
    .live-dot {
      width: 8px; height: 8px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
      box-shadow: 0 0 8px var(--success);
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
    #live-time { color: var(--glow); font-family: 'Space Mono', monospace; }

    /* â”€â”€â”€ TODAY'S SALES SECTION â”€â”€â”€ */
    .today-section {
      margin-bottom: 64px;
      animation: fadeUp 0.8s ease 0.15s both;
    }
    .section-label {
      font-size: 0.72rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .section-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--rim);
    }
    .sales-ticker {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }

    /* â”€â”€â”€ TICKER CARD â”€â”€â”€ */
    .ticker-card {
      position: relative;
      background: var(--panel);
      border: 1px solid var(--rim);
      border-radius: 16px;
      padding: 24px;
      overflow: hidden;
      transition: transform 0.25s ease, border-color 0.25s ease, box-shadow 0.25s ease;
    }
    .ticker-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      border-radius: 16px 16px 0 0;
    }
    .ticker-card.dx::before  { background: var(--dx); }
    .ticker-card.ux::before  { background: var(--ux); }
    .ticker-card.vp::before  { background: var(--vp); }
    .ticker-card.lpg::before { background: var(--lpg); }

    .ticker-card:hover {
      transform: translateY(-4px);
      border-color: rgba(255,255,255,0.15);
      box-shadow: 0 20px 48px rgba(0,0,0,0.4);
    }
    .ticker-glow {
      position: absolute;
      top: -30px; right: -30px;
      width: 120px; height: 120px;
      border-radius: 50%;
      filter: blur(40px);
      opacity: 0.25;
      pointer-events: none;
    }
    .ticker-card.dx  .ticker-glow { background: var(--dx); }
    .ticker-card.ux  .ticker-glow { background: var(--ux); }
    .ticker-card.vp  .ticker-glow { background: var(--vp); }
    .ticker-card.lpg .ticker-glow { background: var(--lpg); }

    .ticker-label {
      font-size: 0.7rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 12px;
    }
    .ticker-product {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.5rem;
      letter-spacing: 2px;
      margin-bottom: 16px;
    }
    .ticker-card.dx  .ticker-product { color: var(--dx); }
    .ticker-card.ux  .ticker-product { color: var(--ux); }
    .ticker-card.vp  .ticker-product { color: var(--vp); }
    .ticker-card.lpg .ticker-product { color: var(--lpg); }

    .ticker-value {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(2.2rem, 3.5vw, 3rem);
      line-height: 1;
      color: #fff;
    }
    .ticker-unit {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.75rem;
      color: var(--muted);
      font-weight: 400;
    }
    .ticker-sub {
      margin-top: 12px;
      font-size: 0.78rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .ticker-vs {
      font-family: 'Space Mono', monospace;
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 700;
    }
    .ticker-vs.up   { background: rgba(16,185,129,0.15); color: var(--success); }
    .ticker-vs.down { background: rgba(239,68,68,0.15);  color: var(--danger); }
    .ticker-vs.flat { background: rgba(100,116,139,0.2); color: var(--muted); }

    .ticker-loading {
      height: 48px;
      display: flex;
      align-items: center;
    }
    .skeleton {
      height: 40px;
      width: 120px;
      background: linear-gradient(90deg, var(--steel) 25%, rgba(255,255,255,0.06) 50%, var(--steel) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 6px;
    }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

    /* â”€â”€â”€ DATE STRIP â”€â”€â”€ */
    .date-strip {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 64px;
      padding: 16px 24px;
      background: var(--panel);
      border: 1px solid var(--rim);
      border-radius: 12px;
      font-family: 'Space Mono', monospace;
      font-size: 0.8rem;
      color: var(--muted);
      animation: fadeUp 0.8s ease 0.2s both;
    }
    .date-strip .highlight { color: var(--glow); }
    .date-strip .sep { color: var(--rim); }

    /* â”€â”€â”€ DASHBOARD GRID â”€â”€â”€ */
    .dashboards-section {
      animation: fadeUp 0.8s ease 0.3s both;
    }
    .dash-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    /* â”€â”€â”€ DASHBOARD CARD â”€â”€â”€ */
    .dash-card {
      position: relative;
      background: var(--panel);
      border: 1px solid var(--rim);
      border-radius: 20px;
      overflow: hidden;
      text-decoration: none;
      color: inherit;
      display: block;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      group: true;
    }
    .dash-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 32px 64px rgba(0,0,0,0.5);
      border-color: rgba(255,255,255,0.15);
    }

    /* Stripe accent top */
    .dash-card .card-accent {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
    }
    .card-1 .card-accent { background: linear-gradient(90deg, #1e3c72, #7e22ce); }
    .card-2 .card-accent { background: linear-gradient(90deg, #0077cc, #00c6ff); }
    .card-3 .card-accent { background: linear-gradient(90deg, #f59e0b, #ef4444); }
    .card-4 .card-accent { background: linear-gradient(90deg, #059669, #34d399); }

    /* Ambient background glow on hover */
    .dash-card .card-bg-glow {
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }
    .card-1 .card-bg-glow { background: radial-gradient(circle at 80% 20%, rgba(126,34,206,0.12) 0%, transparent 60%); }
    .card-2 .card-bg-glow { background: radial-gradient(circle at 80% 20%, rgba(0,119,204,0.12) 0%, transparent 60%); }
    .card-3 .card-bg-glow { background: radial-gradient(circle at 80% 20%, rgba(245,158,11,0.12) 0%, transparent 60%); }
    .card-4 .card-bg-glow { background: radial-gradient(circle at 80% 20%, rgba(52,211,153,0.12) 0%, transparent 60%); }
    .dash-card:hover .card-bg-glow { opacity: 1; }

    .card-inner {
      padding: 32px;
      position: relative;
      z-index: 1;
    }
    .card-emoji {
      font-size: 3rem;
      display: block;
      margin-bottom: 20px;
      transition: transform 0.3s ease;
    }
    .dash-card:hover .card-emoji { transform: scale(1.1) rotate(-3deg); }

    .card-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.8rem;
      letter-spacing: 2px;
      color: #fff;
      margin-bottom: 8px;
    }
    .card-desc {
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.6;
      margin-bottom: 24px;
    }
    .card-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .meta-pill {
      padding: 4px 12px;
      border-radius: 100px;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .pill-blue   { background: rgba(30,60,114,0.5); color: #93c5fd; border: 1px solid rgba(30,60,114,0.8); }
    .pill-purple { background: rgba(126,34,206,0.3); color: #c4b5fd; border: 1px solid rgba(126,34,206,0.5); }
    .pill-amber  { background: rgba(245,158,11,0.2); color: #fcd34d; border: 1px solid rgba(245,158,11,0.4); }
    .pill-red    { background: rgba(239,68,68,0.2);  color: #fca5a5; border: 1px solid rgba(239,68,68,0.4); }
    .pill-green  { background: rgba(5,150,105,0.2);  color: #6ee7b7; border: 1px solid rgba(5,150,105,0.4); }
    .pill-slate  { background: rgba(100,116,139,0.2); color: #94a3b8; border: 1px solid rgba(100,116,139,0.4); }

    .card-arrow {
      position: absolute;
      bottom: 32px; right: 32px;
      width: 40px; height: 40px;
      border-radius: 50%;
      background: var(--rim);
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem;
      transition: transform 0.3s ease, background 0.3s ease;
      z-index: 2;
    }
    .dash-card:hover .card-arrow {
      transform: translate(4px, -4px);
      background: rgba(245,158,11,0.2);
    }

    /* â”€â”€â”€ FOOTER â”€â”€â”€ */
    .site-footer {
      margin-top: 80px;
      padding-top: 32px;
      border-top: 1px solid var(--rim);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 0.78rem;
      color: var(--muted);
      animation: fadeUp 0.8s ease 0.5s both;
    }
    .footer-copy strong { color: rgba(255,255,255,0.5); }
    .footer-legal { max-width: 520px; line-height: 1.6; text-align: right; }

    /* â”€â”€â”€ ANIMATIONS â”€â”€â”€ */
    @keyframes fadeDown {
      from { transform: translateY(-20px); opacity: 0; }
      to   { transform: translateY(0);     opacity: 1; }
    }
    @keyframes fadeUp {
      from { transform: translateY(20px); opacity: 0; }
      to   { transform: translateY(0);    opacity: 1; }
    }

    /* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
    @media (max-width: 900px) {
      .dash-grid { grid-template-columns: 1fr; }
      .sales-ticker { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 560px) {
      .sales-ticker { grid-template-columns: 1fr 1fr; }
      .site-header { flex-direction: column; gap: 16px; }
      .footer-legal { text-align: left; }
    }
  </style>
</head>
<body>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>

  <div class="wrapper">

    <!-- HEADER -->
    <header class="site-header">
      <div class="brand-block">
        <div class="brand-name">Kiryan Energy Ltd</div>
        <div class="brand-sub">Mangu Shell Service Station Â· Operations Analytics</div>
      </div>
      <div class="header-right-cluster">
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme">
          <span id="themeIcon">â˜€ï¸</span>
          <div class="toggle-track"><div class="toggle-thumb"></div></div>
          <span id="themeLabel">Light</span>
        </button>
        <div class="live-badge">
          <div class="live-dot"></div>
          <span>Live Â·</span>
          <span id="live-time">â€”</span>
        </div>
      </div>
    </header>

    <!-- DATE CONTEXT STRIP -->
    <div class="date-strip" id="dateStrip">
      <span>ğŸ“… Today:</span>
      <span class="highlight" id="todayLabel">â€”</span>
      <span class="sep">|</span>
      <span id="monthContext">Loading dataâ€¦</span>
    </div>

    <!-- TODAY'S SALES TICKER -->
    <section class="today-section">
      <div class="section-label">âš¡ Today's Average Sales â€” Live from Google Sheets</div>
      <div class="sales-ticker">

        <!-- DX Diesel -->
        <div class="ticker-card dx">
          <div class="ticker-glow"></div>
          <div class="ticker-label">Product</div>
          <div class="ticker-product">DX Diesel</div>
          <div class="ticker-loading" id="ticker-DX">
            <div class="skeleton"></div>
          </div>
          <div class="ticker-sub" id="sub-DX">â€”</div>
        </div>

        <!-- UX Unleaded -->
        <div class="ticker-card ux">
          <div class="ticker-glow"></div>
          <div class="ticker-label">Product</div>
          <div class="ticker-product">UX Unleaded</div>
          <div class="ticker-loading" id="ticker-UX">
            <div class="skeleton"></div>
          </div>
          <div class="ticker-sub" id="sub-UX">â€”</div>
        </div>

        <!-- VP V-Power -->
        <div class="ticker-card vp">
          <div class="ticker-glow"></div>
          <div class="ticker-label">Product</div>
          <div class="ticker-product">VP V-Power</div>
          <div class="ticker-loading" id="ticker-VP">
            <div class="skeleton"></div>
          </div>
          <div class="ticker-sub" id="sub-VP">â€”</div>
        </div>

        <!-- LPG Gas -->
        <div class="ticker-card lpg">
          <div class="ticker-glow"></div>
          <div class="ticker-label">Product</div>
          <div class="ticker-product">LPG Gas</div>
          <div class="ticker-loading" id="ticker-LPG">
            <div class="skeleton"></div>
          </div>
          <div class="ticker-sub" id="sub-LPG">â€”</div>
        </div>

      </div>
    </section>

    <!-- DASHBOARDS -->
    <section class="dashboards-section">
      <div class="section-label">ğŸš€ Dashboard Suite</div>
      <div class="dash-grid">

        <a href="./fuel/fuel_dashboard_easy_config.html" class="dash-card card-1">
          <div class="card-accent"></div>
          <div class="card-bg-glow"></div>
          <div class="card-inner">
            <span class="card-emoji">â›½</span>
            <div class="card-title">Fuel Per Pump</div>
            <div class="card-desc">Real-time pump volume tracking, daily targets, CSA performance rankings and per-pump efficiency metrics.</div>
            <div class="card-meta">
              <span class="meta-pill pill-blue">Pump 1 Â· 2 Â· 3</span>
              <span class="meta-pill pill-purple">Target Tracking</span>
              <span class="meta-pill pill-slate">v3.0</span>
            </div>
          </div>
          <div class="card-arrow">â†’</div>
        </a>

        <a href="./Product/product_dashboard.html" class="dash-card card-3">
          <div class="card-accent"></div>
          <div class="card-bg-glow"></div>
          <div class="card-inner">
            <span class="card-emoji">ğŸ“Š</span>
            <div class="card-title">Product Analysis</div>
            <div class="card-desc">Inventory variance tracking, meter vs dip reconciliation, stock level alerts and monthly target progress for all fuel products.</div>
            <div class="card-meta">
              <span class="meta-pill pill-amber">DX Â· UX Â· VP</span>
              <span class="meta-pill pill-red">Variance Alerts</span>
              <span class="meta-pill pill-slate">v2.2</span>
            </div>
          </div>
          <div class="card-arrow">â†’</div>
        </a>

        <a href="./Gas/gas_dashboard_pivot_format.html" class="dash-card card-4">
          <div class="card-accent"></div>
          <div class="card-bg-glow"></div>
          <div class="card-inner">
            <span class="card-emoji">ğŸ”¥</span>
            <div class="card-title">Gas Operations</div>
            <div class="card-desc">LPG cylinder refill tracking, new customer acquisition and 3,114.5 KG monthly target monitoring across all four cylinder sizes.</div>
            <div class="card-meta">
              <span class="meta-pill pill-green">6 Â· 13 Â· 25 Â· 45 KG</span>
              <span class="meta-pill pill-amber">New Customers</span>
              <span class="meta-pill pill-slate">v3.3</span>
            </div>
          </div>
          <div class="card-arrow">â†’</div>
        </a>

        <a href="./staff_dashboard.html" class="dash-card card-2" style="grid-column: 1 / -1;">
          <div class="card-accent"></div>
          <div class="card-bg-glow"></div>
          <div class="card-inner">
            <span class="card-emoji">ğŸ‘¥</span>
            <div class="card-title">Staff Management</div>
            <div class="card-desc">Daily KES balance monitoring per CSA, shortage and surplus flagging with multi-month trend analysis.</div>
            <div class="card-meta">
              <span class="meta-pill pill-blue">KES Balances</span>
              <span class="meta-pill pill-red">Shortages</span>
              <span class="meta-pill pill-slate">v2.1</span>
            </div>
          </div>
          <div class="card-arrow">â†’</div>
        </a>

      </div>
    </section>

    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="footer-copy">
        <strong>Â© 2026 Kiryan Energy Ltd</strong> Â· All Rights Reserved
      </div>
      <div class="footer-legal">
        <strong>Confidential.</strong> These dashboards are for official use only.
        Unauthorised access, reproduction or distribution is prohibited.
      </div>
    </footer>

  </div>

  <script>
    // â”€â”€â”€ LIVE CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateClock() {
      const now = new Date();
      document.getElementById('live-time').textContent =
        now.toLocaleTimeString('en-KE', { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false });
    }
    setInterval(updateClock, 1000);
    updateClock();

    // â”€â”€â”€ DATE LABEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const TODAY = new Date();
    const TODAY_STR = TODAY.toISOString().split('T')[0]; // YYYY-MM-DD
    document.getElementById('todayLabel').textContent =
      TODAY.toLocaleDateString('en-KE', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

    // â”€â”€â”€ DATA SOURCES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Fuel products (Product dashboard sheet)
    const FUEL_SOURCES = {
      "February 2026": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRWCk42WV4zp0FBWtNJmxIsFW88QPRxE-2S8cnKG205VfA9ntl_2xMhrTyuRPWS82kDtaszDFDyv7r5/pub?gid=1772695434&single=true&output=csv",
      "January 2026":  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRT8Kama3jzM7pEBPHUY-hUKgiV5Mbp0VC5CN4_-r2MckRoU2xxGcwQb31qeRKjXLg2NHH0eDQlmu3C/pub?gid=1772695434&single=true&output=csv",
    };
    // LPG Gas (Gas dashboard sheet)
    const GAS_SOURCES = {
      "February 2026": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRWCk42WV4zp0FBWtNJmxIsFW88QPRxE-2S8cnKG205VfA9ntl_2xMhrTyuRPWS82kDtaszDFDyv7r5/pub?gid=285948413&single=true&output=csv",
      "January 2026":  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRT8Kama3jzM7pEBPHUY-hUKgiV5Mbp0VC5CN4_-r2MckRoU2xxGcwQb31qeRKjXLg2NHH0eDQlmu3C/pub?gid=285948413&single=true&output=csv",
    };

    // Monthly targets for context
    const TARGETS = { DX: 91152, UX: 88593, VP: 11104 };

    // â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function parseCsvLine(line) {
      const result = []; let cur = ''; let inQ = false;
      for (const c of line) {
        if (c === '"') { inQ = !inQ; continue; }
        if (c === ',' && !inQ) { result.push(cur.trim()); cur = ''; }
        else cur += c;
      }
      result.push(cur.trim());
      return result;
    }

    function getDaysInMonth(monthStr) {
      const d = new Date(monthStr + ' 1');
      return new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
    }

    function isCurrentMonth(monthStr) {
      const d = new Date(monthStr + ' 1');
      return d.getFullYear() === TODAY.getFullYear() && d.getMonth() === TODAY.getMonth();
    }

    function setTicker(product, value, unit, sub, vsClass, vsText) {
      const el = document.getElementById('ticker-' + product);
      el.innerHTML = `
        <div>
          <span class="ticker-value">${value.toLocaleString(undefined, {maximumFractionDigits:1})}</span>
          <span class="ticker-unit"> ${unit}</span>
        </div>`;
      document.getElementById('sub-' + product).innerHTML =
        `${sub} <span class="ticker-vs ${vsClass}">${vsText}</span>`;
    }

    function setTickerError(product, msg) {
      document.getElementById('ticker-' + product).innerHTML =
        `<span style="color:var(--muted);font-size:0.8rem">${msg}</span>`;
    }

    // â”€â”€â”€ FUEL DATA FETCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchFuelData() {
      // Try current month first, then previous
      const months = Object.keys(FUEL_SOURCES);

      for (const month of months) {
        try {
          const resp = await fetch(FUEL_SOURCES[month]);
          if (!resp.ok) continue;
          const text = await resp.text();
          const lines = text.trim().split('\n');

          // Build headers from first line
          const headers = parseCsvLine(lines[0]);

          let lastDate = null;
          const records = []; // { date, product, meterSale }

          lines.slice(1).forEach(line => {
            const cols = parseCsvLine(line);
            const obj = {};
            headers.forEach((h, i) => { obj[h] = cols[i] || ''; });

            const dv = (obj.DATE || '').trim();
            if (dv && !dv.toUpperCase().includes('TOTAL')) {
              const p = dv.split('.');
              if (p.length === 3) {
                lastDate = p[0].length === 4
                  ? `${p[0]}-${p[1].padStart(2,'0')}-${p[2].padStart(2,'0')}`
                  : `${p[2]}-${p[1].padStart(2,'0')}-${p[0].padStart(2,'0')}`;
              }
            }
            if (!lastDate) return;

            const prod = (obj.PRODUCT || '').trim().toUpperCase();
            if (!['UX','DX','VP'].includes(prod)) return;
            const meterSale = parseFloat((obj['METER SALE'] || '0').replace(/,/g,'')) || 0;
            if (meterSale > 0) records.push({ date: lastDate, product: prod, meterSale });
          });

          if (!records.length) continue;

          // Sort & compute averages
          records.sort((a,b) => a.date.localeCompare(b.date));
          const latestDate = records[records.length - 1].date;
          const daysInMonth = getDaysInMonth(month);
          const isCurrent = isCurrentMonth(month);
          // Days elapsed = yesterday if current month, else total days with data
          const uniqueDays = [...new Set(records.map(r => r.date))];
          const daysElapsed = isCurrent
            ? Math.max(TODAY.getDate() - 1, 1)
            : uniqueDays.length;

          // Per-product totals
          const totals = { DX:0, UX:0, VP:0 };
          records.forEach(r => { totals[r.product] = (totals[r.product]||0) + r.meterSale; });

          // Today's actual (if exists)
          const todayRecords = records.filter(r => r.date === TODAY_STR);
          const todaySales = { DX:0, UX:0, VP:0 };
          todayRecords.forEach(r => { todaySales[r.product] = (todaySales[r.product]||0) + r.meterSale; });
          const hasTodayData = todayRecords.length > 0;

          ['DX','UX','VP'].forEach(p => {
            const avg = totals[p] / daysElapsed;
            const dailyTarget = TARGETS[p] / daysInMonth;
            const pctOfTarget = ((avg / dailyTarget) * 100).toFixed(0);
            const vsClass = avg >= dailyTarget ? 'up' : avg >= dailyTarget * 0.85 ? 'flat' : 'down';
            const vsText = (avg >= dailyTarget ? 'â–² ' : 'â–¼ ') + pctOfTarget + '% of target';

            let sub = `Avg over ${daysElapsed} day${daysElapsed > 1 ? 's' : ''}`;
            if (hasTodayData && todaySales[p] > 0) {
              sub = `Today: ${todaySales[p].toLocaleString(undefined,{maximumFractionDigits:0})} L`;
            }
            setTicker(p, avg, 'L / day', sub, vsClass, vsText);
          });

          document.getElementById('monthContext').textContent =
            `Data: ${month} Â· Latest: ${latestDate} Â· ${uniqueDays.length} trading days`;
          return; // success, stop trying

        } catch(e) {
          console.warn('Fuel fetch failed for', month, e);
        }
      }

      // If all fail
      ['DX','UX','VP'].forEach(p => setTickerError(p, 'Data unavailable'));
      document.getElementById('monthContext').textContent = 'Could not load fuel data';
    }

    // â”€â”€â”€ GAS DATA FETCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchGasData() {
      const months = Object.keys(GAS_SOURCES);

      for (const month of months) {
        try {
          const resp = await fetch(GAS_SOURCES[month]);
          if (!resp.ok) continue;
          const text = await resp.text();
          const lines = text.trim().split('\n');

          // Row 0 = product labels, cols 1..n = dates
          const headerRow = parseCsvLine(lines[0]);
          const dates = [];
          for (let i = 1; i < headerRow.length; i++) {
            const raw = headerRow[i].trim();
            const p = raw.split('.');
            if (p.length === 3) {
              dates.push(p[0].length === 4
                ? `${p[0]}-${p[1].padStart(2,'0')}-${p[2].padStart(2,'0')}`
                : `${p[2]}-${p[1].padStart(2,'0')}-${p[0].padStart(2,'0')}`);
            } else {
              dates.push(null);
            }
          }

          let totalKG = 0;
          let todayKG = 0;
          let hasTodayData = false;
          const validDates = new Set();

          for (let ri = 1; ri < lines.length; ri++) {
            const cols = parseCsvLine(lines[ri]);
            const productName = (cols[0] || '').trim().toUpperCase();
            if (!productName || productName.includes('TOTAL')) continue;
            // Only count refills (not EMPTY)
            if (productName.includes('EMPTY')) continue;
            // Get KG per cylinder
            let kgPer = 0;
            if (productName.includes('45')) kgPer = 45;
            else if (productName.includes('25')) kgPer = 25;
            else if (productName.includes('13')) kgPer = 13;
            else if (productName.includes('6')) kgPer = 6;
            if (!kgPer) continue;

            for (let ci = 1; ci < cols.length && ci <= dates.length; ci++) {
              if (!dates[ci-1]) continue;
              const pieces = Math.floor(parseFloat(cols[ci]) || 0);
              if (pieces <= 0) continue;
              const kg = pieces * kgPer;
              totalKG += kg;
              validDates.add(dates[ci-1]);
              if (dates[ci-1] === TODAY_STR) {
                todayKG += kg;
                hasTodayData = true;
              }
            }
          }

          if (!validDates.size) continue;

          const isCurrent = isCurrentMonth(month);
          const daysElapsed = isCurrent
            ? Math.max(TODAY.getDate() - 1, 1)
            : validDates.size;

          const avgKG = totalKG / daysElapsed;
          const dailyTarget = 3114.5 / getDaysInMonth(month);
          const pctOfTarget = ((avgKG / dailyTarget) * 100).toFixed(0);
          const vsClass = avgKG >= dailyTarget ? 'up' : avgKG >= dailyTarget * 0.85 ? 'flat' : 'down';
          const vsText = (avgKG >= dailyTarget ? 'â–² ' : 'â–¼ ') + pctOfTarget + '% of target';
          let sub = `Avg over ${daysElapsed} day${daysElapsed > 1 ? 's' : ''}`;
          if (hasTodayData && todayKG > 0) {
            sub = `Today: ${todayKG.toLocaleString(undefined,{maximumFractionDigits:0})} KG`;
          }
          setTicker('LPG', avgKG, 'KG / day', sub, vsClass, vsText);
          return;

        } catch(e) {
          console.warn('Gas fetch failed for', month, e);
        }
      }
      setTickerError('LPG', 'Data unavailable');
    }

    // â”€â”€â”€ THEME TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      const isLight = theme === 'light';
      document.getElementById('themeIcon').textContent  = isLight ? 'ğŸŒ™' : 'â˜€ï¸';
      document.getElementById('themeLabel').textContent = isLight ? 'Dark' : 'Light';
      localStorage.setItem('ke-theme', theme);
    }

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme') || 'dark';
      applyTheme(current === 'dark' ? 'light' : 'dark');
    }

    // Load saved preference on boot (before paint to avoid flash)
    (function() {
      const saved = localStorage.getItem('ke-theme') || 'dark';
      applyTheme(saved);
    })();

    // â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    fetchFuelData();
    fetchGasData();
  </script>
</body>
</html>
