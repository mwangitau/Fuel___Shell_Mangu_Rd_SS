<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gas Sales Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #333;
      margin: 0;
      padding: 20px;
    }
    .container { max-width: 1300px; margin: auto; }
    .header { text-align: center; color: white; margin-bottom: 30px; }
    .refresh-btn {
      background: white;
      color: #667eea;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
    }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; }
    .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px,1fr)); gap: 20px; }
    .chart-card { background: white; border-radius: 10px; padding: 20px; }
    .table-card { background: white; border-radius: 10px; padding: 20px; margin-top: 30px; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #667eea; color: white; position: sticky; top: 0; }
    .loading { text-align: center; color: white; }
    .spinner { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; width: 40px; height: 40px; margin: 10px auto; animation: spin 1s linear infinite; }
    @keyframes spin { from {transform: rotate(0);} to {transform: rotate(360deg);} }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸ”¥ Gas Sales Dashboard</h1>
      <p id="headerText">All Months Overview</p>
      <button class="refresh-btn" onclick="loadData()" id="refreshBtn">ðŸ”„ Refresh Data</button>

      <select id="monthSelector" onchange="switchMonth(this.value)" style="
        padding:8px 12px; border-radius:8px; border:none; font-weight:bold; color:#667eea; margin-left:10px;">
        <option value="All">All Months</option>
        <option value="September">September</option>
        <option value="October">October</option>
      </select>

      <div id="lastUpdated" style="margin-top:8px; font-size:13px; color:#dcdcdc; font-style:italic;">
        Last updated: (loadingâ€¦)
      </div>
    </div>

    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Loading data...</p>
    </div>

    <div id="dashboard" style="display: none;">
      <div class="stats-grid" id="statsGrid"></div>

      <div class="charts-grid">
        <div class="chart-card">
          <h2>ðŸ“ˆ Daily Sales Trend</h2>
          <canvas id="dailyTrendChart"></canvas>
        </div>
        <div class="chart-card">
          <h2>ðŸŽ¯ Product Distribution</h2>
          <canvas id="productDistChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <h2>ðŸ“Š Product Performance Over Time</h2>
        <canvas id="productTrendChart"></canvas>
      </div>

      <div class="table-card">
        <h2>ðŸ“‹ Detailed Sales Data</h2>
        <table id="dataTable"></table>
      </div>
    </div>
  </div>

  <script>
    // âœ… Your API Endpoints
    const SEPTEMBER_API = "https://script.google.com/macros/s/AKfycbhsXZAG60VwIl2vxiZwY7FJn41KMxORvpeTGRq-OUy9t5SJaOhKXcWvnn-fZZ6DY5d/exec";
    const OCTOBER_API   = "https://script.google.com/macros/s/AKfycbwalM3Oh0m8Q7SUD00jXxw32EOo4m9UQM2iwV0_UzjUTDd6VkHGSvZK2v_TcN0nibXQ/exec";

    let allData = [];
    let currentMonth = "All";
    let charts = {};

    async function loadData() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('refreshBtn').disabled = true;

      try {
        const [sepRes, octRes] = await Promise.all([
          fetch(SEPTEMBER_API).then(r => r.json()),
          fetch(OCTOBER_API).then(r => r.json())
        ]);

        const sepData = sepRes.data || [];
        const octData = octRes.data || [];

        // Merge both months
        allData = [...sepData, ...octData];

        document.getElementById('lastUpdated').textContent = "Last updated: " + new Date().toLocaleString();
        switchMonth(currentMonth);

      } catch (err) {
        alert("Failed to load data: " + err.message);
        console.error(err);
      } finally {
        document.getElementById('refreshBtn').disabled = false;
      }
    }

    function switchMonth(month) {
      currentMonth = month;
      document.getElementById('headerText').textContent =
        month === 'September' ? 'September Overview' :
        month === 'October' ? 'October Overview' : 'All Months Overview';

      let filtered = allData;
      if (month !== "All") {
        filtered = allData.filter(row => {
          const d = new Date(row.Date || row.DATE || row.date);
          const m = d.toLocaleString('en-US', { month: 'long' });
          return m === month;
        });
      }
      displayData(filtered);
    }

    function displayData(data) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';

      const totalKG = data.reduce((sum, r) => sum + (Number(r.TotalKGs) || 0), 0);
      document.getElementById('statsGrid').innerHTML = `
        <div class="stat-card">
          <h3>Total KGs Sold</h3>
          <div class="value">${totalKG.toLocaleString()}</div>
          <div class="label">${currentMonth}</div>
        </div>`;

      createDailyTrendChart(data);
      createProductDistributionChart(data);
      createDataTable(data);
    }

    function createDailyTrendChart(data) {
      if (charts.dailyTrend) charts.dailyTrend.destroy();

      const labels = data.map(r => r.Date || r.DATE);
      const values = data.map(r => Number(r.TotalKGs) || 0);

      charts.dailyTrend = new Chart(document.getElementById('dailyTrendChart'), {
        type: 'line',
        data: { labels, datasets: [{ label: 'Total KGs', data: values, borderColor: '#667eea', fill: false }] },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
    }

    function createProductDistributionChart(data) {
      if (charts.productDist) charts.productDist.destroy();

      const total6 = data.filter(r => r.Product?.includes('6KG')).reduce((a,b) => a + (Number(b.TotalKGs)||0), 0);
      const total13 = data.filter(r => r.Product?.includes('13KG')).reduce((a,b) => a + (Number(b.TotalKGs)||0), 0);
      const total45 = data.filter(r => r.Product?.includes('45KG')).reduce((a,b) => a + (Number(b.TotalKGs)||0), 0);

      charts.productDist = new Chart(document.getElementById('productDistChart'), {
        type: 'doughnut',
        data: { labels: ['6KG','13KG','45KG'], datasets: [{ data: [total6,total13,total45], backgroundColor: ['#667eea','#764ba2','#f093fb'] }] },
        options: { plugins: { legend: { position: 'bottom' } } }
      });
    }

    function createDataTable(data) {
      const table = document.getElementById('dataTable');
      if (!data.length) {
        table.innerHTML = "<tr><td>No data available</td></tr>";
        return;
      }
      const keys = Object.keys(data[0]);
      let html = "<thead><tr>" + keys.map(k => `<th>${k}</th>`).join('') + "</tr></thead><tbody>";
      data.forEach(r => {
        html += "<tr>" + keys.map(k => `<td>${r[k] || ''}</td>`).join('') + "</tr>";
      });
      html += "</tbody>";
      table.innerHTML = html;
    }

    window.addEventListener('load', loadData);
  </script>
</body>
</html>


