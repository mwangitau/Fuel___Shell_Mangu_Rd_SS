<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Product Dashboard — Kiryan Energy Ltd</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Recharts -->
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <!-- PapaParse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { LineChart, Line, XAxis, YAxis, Tooltip, Legend, CartesianGrid, PieChart, Pie, Cell, ResponsiveContainer } = Recharts;

    const CSV_URLS = {
      August: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSy-gNhdVGwWtpwJIZ2358iDhM0RQlQoen-_wayM6Dc0rkp9mRx40uLo4ia2QD3Kr_QNn75xp8OJKEx/pub?gid=1227672918&single=true&output=csv",
      September: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS-k0UvgWAF628NHqYnQ58rXfOpyMnrqnRa19R-icgOlkeK2yEhP3hg2_9CtwYCHZ08ciLYioLZNTc7/pub?gid=1763262818&single=true&output=csv"
    };

    const toNumber = v => {
      if (!v) return 0;
      const n = String(v).replace(/[,\\s]/g,"");
      return isNaN(parseFloat(n)) ? 0 : parseFloat(n);
    }

    function ProductDashboard() {
      const [dataByMonth, setDataByMonth] = useState({});
      const [loading, setLoading] = useState(true);
      const [selectedMonth, setSelectedMonth] = useState("Both");
      const [selectedProducts, setSelectedProducts] = useState(["UX","DX","VPOWER"]);

      useEffect(() => {
        Promise.all(Object.entries(CSV_URLS).map(([month,url]) =>
          new Promise(resolve => {
            Papa.parse(url, {
              download: true,
              header: true,
              skipEmptyLines: true,
              complete: (results) => {
                const rows = results.data.map(r => ({
                  date: r["DATES"] || r[Object.keys(r)[0]],
                  UX: toNumber(r["UX"] || r["Ux"] || r[Object.keys(r)[1]]),
                  DX: toNumber(r["DX"] || r["Dx"] || r[Object.keys(r)[2]]),
                  VPOWER: toNumber(r["V-POWER"] || r["VPOWER"] || r[Object.keys(r)[3]]),
                })).filter(r => r.date);
                resolve([month, rows]);
              }
            });
          })
        )).then(allData => {
          const mapped = {};
          allData.forEach(([month,rows]) => mapped[month] = rows);
          setDataByMonth(mapped);
          setLoading(false);
        });
      }, []);

      const data = useMemo(() => {
        if (selectedMonth === "Both") {
          return [].concat(dataByMonth["August"] || [], dataByMonth["September"] || []);
        }
        return dataByMonth[selectedMonth] || [];
      }, [dataByMonth, selectedMonth]);

      const pieData = useMemo(() => {
        const sum = data.reduce((acc,r) => {
          acc.UX += r.UX; acc.DX += r.DX; acc.VPOWER += r.VPOWER;
          return acc;
        }, {UX:0, DX:0, VPOWER:0});
        return [
          { name: "UX", value: sum.UX },
          { name: "DX", value: sum.DX },
          { name: "V-POWER", value: sum.VPOWER }
        ];
      }, [data]);

      const COLORS = ["#60A5FA","#34D399","#FCA5A5"];

      if (loading) return <div className="p-6 text-lg">⏳ Loading data...</div>;

      return (
        <div className="p-6 max-w-7xl mx-auto">
          <h1 className="text-2xl font-bold mb-6">Interactive Product Dashboard</h1>

          {/* Filters */}
          <div className="flex flex-wrap gap-4 mb-6">
            <div>
              <label className="font-semibold mr-2">Month:</label>
              <select value={selectedMonth} onChange={e => setSelectedMonth(e.target.value)} className="border px-2 py-1 rounded">
                <option value="Both">Both</option>
                <option value="August">August</option>
                <option value="September">September</option>
              </select>
            </div>
            <div>
              <label className="font-semibold mr-2">Products:</label>
              {["UX","DX","VPOWER"].map(p => (
                <label key={p} className="mr-3">
                  <input
                    type="checkbox"
                    checked={selectedProducts.includes(p)}
                    onChange={e => {
                      if (e.target.checked) setSelectedProducts([...selectedProducts, p]);
                      else setSelectedProducts(selectedProducts.filter(x => x !== p));
                    }}
                  /> {p}
                </label>
              ))}
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            {/* Line Chart */}
            <div className="bg-white p-4 rounded shadow h-96">
              <h2 className="mb-2 font-semibold">Daily Sales Trend</h2>
              <ResponsiveContainer width="100%" height={300}>
                <LineChart data={data}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="date" />
                  <YAxis />
                  <Tooltip />
                  <Legend />
                  {selectedProducts.includes("UX") && <Line type="monotone" dataKey="UX" stroke="#60A5FA" />}
                  {selectedProducts.includes("DX") && <Line type="monotone" dataKey="DX" stroke="#34D399" />}
                  {selectedProducts.includes("VPOWER") && <Line type="monotone" dataKey="VPOWER" stroke="#FCA5A5" />}
                </LineChart>
              </ResponsiveContainer>
            </div>

            {/* Pie Chart */}
            <div className="bg-white p-4 rounded shadow h-96">
              <h2 className="mb-2 font-semibold">Total Sales Share</h2>
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie data={pieData} dataKey="value" nameKey="name" innerRadius={40} outerRadius={70} label>
                    {pieData.map((entry,index) => <Cell key={index} fill={COLORS[index % COLORS.length]} />)}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            </div>

          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<ProductDashboard />);
  </script>
</body>
</html>


